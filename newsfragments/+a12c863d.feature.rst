Reworked much of the blowfish implementation.